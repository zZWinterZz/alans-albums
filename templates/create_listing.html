{% extends 'base.html' %}
{% block title %}Create Listing{% endblock %}

{% block content %}
<div class="container">
  <h1 class="mt-4">Create Listing</h1>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card mb-3">
      <div class="card-body">
        <div class="mb-2">
          <label class="form-label">Artist</label>
          <input name="artist" value="{{ artist }}" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Title</label>
          <input name="title" value="{{ title }}" class="form-control">
        </div>
        <div class="mb-2 row">
          <div class="col">
            <label class="form-label">Year</label>
            <input name="year" value="{{ year }}" class="form-control">
          </div>
          <div class="col">
            <label class="form-label">Country</label>
            <input name="country" value="{{ country }}" class="form-control">
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Catalog Number</label>
          <input name="catalog_number" value="{{ catalog_number }}" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Formats</label>
          <textarea name="formats" class="form-control" rows="3">{{ formats }}</textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Notes</label>
          <textarea name="release_notes" class="form-control" rows="4">{{ release_notes }}</textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Price</label>
          <input name="price" value="{{ price }}" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Cover image URL (thumb)</label>
          <input name="thumb" value="{{ thumb }}" class="form-control">
          {% if thumb %}
          <div class="mt-2"><img src="{{ thumb }}" style="width:120px;object-fit:cover;border-radius:4px"></div>
          {% endif %}
        </div>
        <div class="mb-2">
          <label class="form-label">Upload images</label>
          <input type="file" name="images" id="id_images_create" multiple class="form-control">
          <div id="create-images-preview" class="d-flex gap-2 flex-wrap mt-2"></div>
        </div>
        <div class="d-flex gap-2">
          <button class="button-primary">Create</button>
          <a href="{% url 'manage_discogs' %}" class="btn btn-secondary">Back to search</a>
        </div>
        <div class="form-check form-switch mt-3">
          <input class="form-check-input" type="checkbox" id="id_featured_create" name="featured">
          <label class="form-check-label" for="id_featured_create">Featured</label>
        </div>
      </div>
    </div>
  </form>
</div>
<script>
  (function(){
    const input = document.getElementById('id_images_create');
    const preview = document.getElementById('create-images-preview');
    if(!input || !preview) return;
    function makeThumb(file, index){
      const url = URL.createObjectURL(file);
      const wrap = document.createElement('div');
      wrap.className = 'position-relative';
      wrap.style.width = '84px';
      wrap.style.height = '84px';
      wrap.style.borderRadius = '6px';
      wrap.style.overflow = 'hidden';
      const img = document.createElement('img');
      img.src = url;
      img.style.width = '100%';
      img.style.height = '100%';
      img.style.objectFit = 'cover';
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn btn-sm btn-outline-danger position-absolute';
      btn.style.top = '4px';
      btn.style.right = '4px';
      btn.innerText = 'Ã—';
      btn.addEventListener('click', function(){
        const dt = new DataTransfer();
        Array.from(input.files).forEach((f, i)=>{ if(i!==index) dt.items.add(f); });
        input.files = dt.files;
        render();
      });
      wrap.appendChild(img);
      wrap.appendChild(btn);
      return wrap;
    }
    function render(){
      preview.innerHTML = '';
      Array.from(input.files).forEach((f, i)=> preview.appendChild(makeThumb(f,i)));
    }
    input.addEventListener('change', render);
  })();
</script>
{% endblock %}
